<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>蟹老板软件屋</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', 'Microsoft YaHei', sans-serif; background: #0a0a0f; color: #ffffff; overflow-x: hidden; }
        .bg-animation { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: linear-gradient(45deg, #0a0a0f, #1a1a2e, #16213e); animation: gradientShift 15s ease infinite; }
        @keyframes gradientShift { 0%, 100% { background: linear-gradient(45deg, #0a0a0f, #1a1a2e, #16213e); } 50% { background: linear-gradient(45deg, #16213e, #0a0a0f, #1a1a2e); } }
        nav { position: fixed; top: 0; width: 100%; padding: 20px 50px; background: rgba(10, 10, 15, 0.9); backdrop-filter: blur(10px); z-index: 1000; transition: all 0.3s ease; }
        .notification-bar { position: fixed; top: 80px; width: 100%; height: 50px; background: linear-gradient(45deg, rgba(79, 172, 254, 0.2), rgba(0, 242, 254, 0.2)); border-top: 1px solid rgba(79, 172, 254, 0.3); border-bottom: 1px solid rgba(79, 172, 254, 0.3); overflow: hidden; z-index: 999; display: flex; align-items: center; }
        .notification-content-wrapper { display: inline-block; animation: scrollLeft 20s linear infinite; }
        .notification-content-wrapper.scroll-right { animation-name: scrollRight; }
        @keyframes scrollLeft { 0% { transform: translateX(100vw); } 100% { transform: translateX(-100%); } }
        @keyframes scrollRight { 0% { transform: translateX(-100%); } 100% { transform: translateX(100vw); } }
        .nav-container { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; }
        .logo { font-size: 24px; font-weight: bold; cursor: pointer; display: flex; align-items: center; z-index: 1001; }
        #logoIcon { height: 30px; margin-right: 10px; }
        #logoText { background: linear-gradient(45deg, #4facfe, #00f2fe); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nav-links { display: flex; list-style: none; gap: 30px; }
        .nav-links a { color: #ffffff; text-decoration: none; transition: all 0.3s ease; position: relative; }
        .nav-links a:hover { color: #4facfe; }
        .nav-links a::after { content: ''; position: absolute; bottom: -5px; left: 0; width: 0; height: 2px; background: linear-gradient(45deg, #4facfe, #00f2fe); transition: width 0.3s ease; }
        .nav-links a:hover::after { width: 100%; }
        .admin-btn { padding: 10px 20px; background: linear-gradient(45deg, #4facfe, #00f2fe); border: none; border-radius: 25px; color: white; cursor: pointer; transition: all 0.3s ease; }
        .admin-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3); }
        .main-content { padding-top: 150px; min-height: 100vh; }
        .hero-section { text-align: center; padding: 100px 50px; max-width: 1200px; margin: 0 auto; }
        .hero-title { font-size: 4rem; margin-bottom: 20px; background: linear-gradient(45deg, #4facfe, #00f2fe); -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: slideInUp 1s ease; }
        .hero-subtitle { font-size: 1.5rem; margin-bottom: 40px; opacity: 0.8; animation: slideInUp 1s ease 0.2s both; }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
        .software-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; padding: 50px; max-width: 1200px; margin: 0 auto; }
        .software-card { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(79, 172, 254, 0.3); border-radius: 15px; padding: 30px; transition: all 0.3s ease; backdrop-filter: blur(10px); display: flex; flex-direction: column; }
        .software-card:hover { transform: translateY(-10px); border-color: rgba(79, 172, 254, 0.8); box-shadow: 0 20px 40px rgba(79, 172, 254, 0.2); }
        .software-image-container { width: 100%; height: 200px; border-radius: 10px; margin-bottom: 20px; background-color: rgba(0,0,0,0.2); overflow: hidden; }
        .software-image { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease; }
        .software-card:hover .software-image { transform: scale(1.05); }
        .software-title { font-size: 1.5rem; margin-bottom: 10px; color: #4facfe; }
        .software-description { opacity: 0.8; line-height: 1.6; margin-bottom: 20px; flex-grow: 1; }
        .software-version { font-size: 0.9rem; color: #00f2fe; margin-bottom: 15px; }
        .download-btn { padding: 12px 25px; background: linear-gradient(45deg, #4facfe, #00f2fe); border: none; border-radius: 25px; color: white; cursor: pointer; transition: all 0.3s ease; width: 100%; margin-top: auto; }
        .download-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3); }
        .admin-panel { display: none; padding: 50px; max-width: 1200px; margin: 0 auto; }
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; flex-wrap: wrap; }
        .admin-title { font-size: 2.5rem; background: linear-gradient(45deg, #4facfe, #00f2fe); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .add-software-btn { padding: 15px 30px; background: linear-gradient(45deg, #4facfe, #00f2fe); border: none; border-radius: 25px; color: white; cursor: pointer; font-size: 1rem; transition: all 0.3s ease; margin-top: 10px; }
        .add-software-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3); }
        .admin-table { background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 30px; backdrop-filter: blur(10px); border: 1px solid rgba(79, 172, 254, 0.3); overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid rgba(79, 172, 254, 0.2); vertical-align: middle; white-space: nowrap; }
        th { background: rgba(79, 172, 254, 0.1); color: #4facfe; font-weight: bold; }
        .admin-table-image { width: 100px; height: 60px; object-fit: cover; border-radius: 5px; }
        .action-btn { padding: 8px 15px; border: none; border-radius: 20px; cursor: pointer; margin: 0 5px; transition: all 0.3s ease; }
        .edit-btn { background: linear-gradient(45deg, #4facfe, #00f2fe); color: white; }
        .delete-btn { background: linear-gradient(45deg, #ff416c, #ff4b2b); color: white; }
        .action-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); }
        .order-btn { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(79, 172, 254, 0.3); color: white; width: 30px; height: 30px; border-radius: 50%; padding: 0; margin: 0 2px; }
        .order-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); backdrop-filter: blur(5px); overflow-y: auto; }
        .modal-content { background: rgba(26, 26, 46, 0.95); margin: 5% auto; padding: 40px; border: 1px solid rgba(79, 172, 254, 0.3); border-radius: 15px; width: 90%; max-width: 600px; backdrop-filter: blur(10px); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .modal-title { font-size: 1.8rem; color: #4facfe; }
        .close { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.3s ease; }
        .close:hover { color: #4facfe; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #4facfe; font-weight: bold; }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; border: 1px solid rgba(79, 172, 254, 0.3); border-radius: 8px; background: rgba(255, 255, 255, 0.05); color: white; font-size: 1rem; transition: all 0.3s ease; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: #4facfe; box-shadow: 0 0 10px rgba(79, 172, 254, 0.3); }
        .form-group textarea { height: 100px; resize: vertical; }
        .image-preview-area { margin-top: 10px; }
        .image-preview { max-width: 100%; height: auto; max-height: 100px; border-radius: 8px; border: 1px solid rgba(79, 172, 254, 0.3); }
        .form-actions { display: flex; justify-content: flex-end; gap: 15px; margin-top: 30px; }
        .cancel-btn, .save-btn { padding: 12px 25px; border-radius: 25px; cursor: pointer; transition: all 0.3s ease; }
        .cancel-btn { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(79, 172, 254, 0.3); color: white; }
        .cancel-btn:hover { background: rgba(255, 255, 255, 0.2); }
        .save-btn { background: linear-gradient(45deg, #4facfe, #00f2fe); border: none; color: white; }
        .save-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3); }
        .about-us-content { max-height: 60vh; overflow-y: auto; line-height: 1.8; color: #ccc; padding-right: 15px; }
        .about-us-content h3 { color: #4facfe; margin-top: 25px; margin-bottom: 10px; border-left: 4px solid #00f2fe; padding-left: 10px; }
        .about-us-content p { margin-bottom: 15px; text-indent: 2em; }
        .contact-content { text-align: center; padding: 20px; color: #fff; line-height: 1.6; }
        .contact-content img { display: block; margin: 20px auto 0 auto; max-width: 100%; height: auto; max-height: 300px; border-radius: 10px; border: 1px solid rgba(79, 172, 254, 0.3); }
        .contact-text { white-space: pre-wrap; text-align: center; }

        /* ========= START: 新增的移动端适配样式 ========= */
        .nav-toggle { display: none; cursor: pointer; z-index: 1001; }
        .nav-toggle span { display: block; width: 25px; height: 3px; background-color: white; margin: 5px 0; transition: all 0.3s ease-in-out; }

        /* 当菜单打开时，汉堡包按钮变成 "X" */
        .nav-open .nav-toggle span:nth-child(1) { transform: translateY(8px) rotate(45deg); }
        .nav-open .nav-toggle span:nth-child(2) { opacity: 0; }
        .nav-open .nav-toggle span:nth-child(3) { transform: translateY(-8px) rotate(-45deg); }
        
        @media (max-width: 768px) {
            nav { padding: 20px; }
            .notification-bar { top: 70px; }
            .main-content { padding-top: 130px; }
            .hero-section { padding: 80px 20px; }
            .software-grid { padding: 30px 20px; }
            .admin-panel { padding: 30px 20px; }

            .hero-title { font-size: 2.5rem; }
            .hero-subtitle { font-size: 1.2rem; }

            .admin-header { flex-direction: column; align-items: flex-start; gap: 20px; }

            .nav-links {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100vh;
                background: rgba(10, 10, 15, 0.98);
                backdrop-filter: blur(15px);
                flex-direction: column;
                justify-content: center;
                align-items: center;
                gap: 40px;
                transform: translateX(100%);
                transition: transform 0.3s ease-in-out;
            }
            
            .nav-open .nav-links { transform: translateX(0); }
            
            .nav-links a { font-size: 1.5rem; }
            
            .admin-btn {
                display: none; /* 在移动端菜单中可以单独创建一个链接来替代 */
            }

            .nav-toggle {
                display: block; /* 只在移动端显示汉堡包按钮 */
            }
            
            /* 确保模态框在手机上也有好的边距 */
            .modal-content { padding: 25px; }
        }
        /* ========= END: 新增的移动端适配样式 ========= */
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <nav>
        <div class="nav-container">
            <div class="logo" onclick="showHome()">
                <img id="logoIcon" src="" alt="Logo Icon" style="display: none;">
                <span id="logoText"></span>
            </div>
            
            <!-- START: 移动端导航链接和管理后台按钮被移到这里 -->
            <ul class="nav-links">
                <li><a href="#" onclick="showHome(); closeMobileMenu();">首页</a></li>
                <li><a href="#" onclick="scrollToSoftware(); closeMobileMenu();">软件展示</a></li>
                <li><a href="#" onclick="showAbout(); closeMobileMenu();">蟹老板的传说</a></li>
                <li><a href="#" onclick="showContact(); closeMobileMenu();">联系方式</a></li>
                <!-- 在移动菜单中也提供后台入口 -->
                <li><a href="#" onclick="showAdmin(); closeMobileMenu();" class="admin-btn-mobile" style="color: #4facfe;">管理后台</a></li>
            </ul>
            <!-- END -->

            <button class="admin-btn" onclick="showAdmin()">管理后台</button>

            <!-- START: 新增的汉堡包菜单按钮 -->
            <div class="nav-toggle" onclick="toggleMobileMenu()">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <!-- END -->
        </div>
    </nav>

    <div class="notification-bar">
        <div class="notification-content-wrapper">
            <span id="notificationContent"></span>
        </div>
    </div>

    <div class="main-content">
        <div id="home-content">
            <div class="hero-section">
                <h1 class="hero-title">创新软件解决方案</h1>
                <p class="hero-subtitle">探索未来科技，体验极致创新</p>
            </div>
            <div id="software-showcase" class="software-grid"></div>
        </div>

        <div id="admin-content" class="admin-panel">
            <div class="admin-header">
                <h2 class="admin-title">软件管理后台</h2>
                <div>
                    <button class="add-software-btn" onclick="showContactSettingsModal()" style="margin-right: 15px;">联系设置</button>
                    <button class="add-software-btn" onclick="showLogoSettingsModal()" style="margin-right: 15px;">Logo设置</button>
                    <button class="add-software-btn" onclick="showNotificationModal()" style="margin-right: 15px;">通知设置</button>
                    <button class="add-software-btn" onclick="showAddModal()" style="margin-right: 15px;">添加新软件</button>
                    <button class="add-software-btn" onclick="logout()" style="background: linear-gradient(45deg, #ff416c, #ff4b2b);">退出登录</button>
                </div>
            </div>
            <div class="admin-table">
                <table>
                    <thead>
                        <tr>
                            <th>软件截图</th>
                            <th>软件名称</th>
                            <th>版本</th>
                            <th>描述</th>
                            <th>排序</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="admin-table-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="softwareModal" class="modal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title" id="modalTitle"></h3><span class="close" onclick="closeModal()">&times;</span></div><div><div class="form-group"><label for="softwareName">软件名称</label><input type="text" id="softwareName"></div><div class="form-group"><label for="softwareVersion">版本号</label><input type="text" id="softwareVersion"></div><div class="form-group"><label for="softwareDescription">软件描述</label><textarea id="softwareDescription"></textarea></div><div class="form-group"><label for="imagePath">软件截图文件名</label><input type="text" id="imagePath" placeholder="例如: screenshot.png"><div class="image-preview-area"><img id="imagePathPreview" class="image-preview" src="" style="display:none;" alt="预览"></div></div><div class="form-group"><label for="downloadUrl">下载链接</label><input type="url" id="downloadUrl" placeholder="https://example.com/download"></div><div class="form-actions"><button type="button" class="cancel-btn" onclick="closeModal()">取消</button><button type="button" class="save-btn" onclick="saveSoftware()">保存</button></div></div></div></div>
    <div id="logoSettingsModal" class="modal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">Logo 设置</h3><span class="close" onclick="closeLogoSettingsModal()">&times;</span></div><div><div class="form-group"><label for="logoTextInput">Logo 文字</label><input type="text" id="logoTextInput"></div><div class="form-group"><label for="logoPathInput">Logo 图标文件名 (可选)</label><input type="text" id="logoPathInput" placeholder="例如: logo.png"><div class="image-preview-area"><img id="logoPathPreview" class="image-preview" src="" style="display:none;" alt="预览"></div></div><div class="form-actions"><button type="button" class="cancel-btn" onclick="closeLogoSettingsModal()">取消</button><button type="button" class="save-btn" onclick="saveLogoSettings()">保存设置</button></div></div></div></div>
    <div id="notificationModal" class="modal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">通知栏设置</h3><span class="close" onclick="closeNotificationModal()">&times;</span></div><div><div class="form-group"><label for="notificationText">通知内容</label><textarea id="notificationText"></textarea></div><div class="form-group"><label for="scrollDirection">滚动方向</label><select id="scrollDirection" style="width: 100%; padding: 12px; border: 1px solid rgba(79, 172, 254, 0.3); border-radius: 8px; background: rgba(255, 255, 255, 0.05); color: white; font-size: 1rem;"><option value="left" style="background: #1a1a2e; color: white;">从右向左</option><option value="right" style="background: #1a1a2e; color: white;">从左向右</option></select></div><div class="form-group"><label for="scrollSpeed">滚动速度</label><select id="scrollSpeed" style="width: 100%; padding: 12px; border: 1px solid rgba(79, 172, 254, 0.3); border-radius: 8px; background: rgba(255, 255, 255, 0.05); color: white; font-size: 1rem;"><option value="slow" style="background: #1a1a2e; color: white;">慢速 (30秒)</option><option value="normal" style="background: #1a1a2e; color: white;" selected>正常 (20秒)</option><option value="fast" style="background: #1a1a2e; color: white;">快速 (10秒)</option></select></div><div class="form-actions"><button type="button" class="cancel-btn" onclick="closeNotificationModal()">取消</button><button type="button" class="save-btn" onclick="saveNotificationSettings()">保存设置</button></div></div></div></div>
    <div id="contactSettingsModal" class="modal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">联系方式设置</h3><span class="close" onclick="closeContactSettingsModal()">&times;</span></div><div><div class="form-group"><label for="contactText">联系方式文字</label><textarea id="contactText" rows="5"></textarea></div><div class="form-group"><label for="contactQRCodePath">二维码图片文件名</label><input type="text" id="contactQRCodePath" placeholder="例如: qrcode.png"><div class="image-preview-area"><img id="contactQRCodePreview" class="image-preview" src="" style="display:none;" alt="预览"></div></div><div class="form-actions"><button type="button" class="cancel-btn" onclick="closeContactSettingsModal()">取消</button><button type="button" class="save-btn" onclick="saveContactSettings()">保存设置</button></div></div></div></div>
    <div id="loginModal" class="modal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">管理员登录</h3><span class="close" onclick="closeLoginModal()">&times;</span></div><div><div class="form-group"><label for="username">用户名</label><input type="text" id="username" placeholder="请输入用户名"></div><div class="form-group"><label for="password">密码</label><input type="password" id="password" placeholder="请输入密码"></div><div class="form-actions" style="margin-top: 40px;"><button type="button" class="cancel-btn" onclick="closeLoginModal()">取消</button><button type="button" class="save-btn" onclick="performLogin()">登录</button></div></div></div></div>
    <div id="aboutUsModal" class="modal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">蟹老板的传说 - 蟹老板外传</h3><span class="close" onclick="closeAboutUsModal()">&times;</span></div><div class="about-us-content"><h3>第一章 壳里的第一页</h3><p>在招投标的江湖里，一直流传着一个名字——蟹老板。传说他并非凡人，而是一只从远古合同之海里爬上岸的寄居蟹，壳里藏着的是一部用贝壳镌刻的《标书真经》。</p><p>蟹老板初到人间时，不过是一只指甲盖大的小蟹，被海浪拍在滨海市招标办的台阶上。那天，一份价值十亿的跨海大桥 PPP 项目资格预审文件被风刮落，盖住了他的壳。蟹老板顺势钻进文件袋，在“投标人须知”里睡了一夜。第二天，人们只看见文件袋自己在地上横着走，留下一道盐霜般的字迹——“评分条款 3.2.5，缺‘项目经理无在建承诺’，扣 5 分。”</p><p>从此，招标办的人开始传说：有一只蟹，能在一夜间把废标变成满分。</p><h3>第二章 蟹行水印</h3><p>蟹老板修炼成精后，开了一家只有夜色里才能找到的打印店，招牌是“水印事务所”。</p><p>店里没有电脑，只有一只古旧的铜盆。客户把 U 盘插进去，水面立刻浮出投标文件的三维幻影：暗标章在左侧第 17 页“咔哒”一声自动归位，技术暗标里的 BIM 模型像珊瑚一样长出关键节点。最神的是报价部分——铜盆里会升起一串气泡，每个气泡里都是竞争对手历史下浮率，蟹老板用钳子“啪”地戳破一个，下浮点就自动减 0.5%，不多不少正好踩在基准价上。</p><p>据说，中过标的客户第二天醒来，只记得梦里一只青灰色的蟹，举着激光笔在页边距 2.5 厘米处画了一道红线。那红线后来谁也擦不掉，复印、扫描、OCR 识别都带着淡淡蟹影，成了蟹老板的防伪水印。</p><h3>第三章 废标劫</h3><p>2018 年，滨海市轨交 8 号线招标，蟹老板帮一家小企业做标书。开标前夜，竞争对手请来“流标鬼”，在服务器里植入 0.01% 的乱码。</p><p>蟹老板不慌，把整份投标文件拆成 17 万片碎壳，每片壳背刻一行小楷，再让壳片顺着网线游回招标中心主机，像寄居蟹排队钻进新壳。凌晨 3:33，主机风扇突然停转，屏幕闪出一只蟹的剪影——0.01% 的乱码被夹成了“技术可行”四个字。</p><p>开标结果公布，小企业以 0.13 分的优势险胜。评委组组长后来回忆：“唱标时，我闻到一股淡淡海腥味，PPT 目录页右下角有一只蟹的水印，心里就踏实了。”</p><h3>第四章 壳归大海</h3><p>蟹老板最后一次出现，是在 2025 年 8 月 7 日——也就是今天。</p><p>滨海市发布全球首个“深海浮式风电 EPC”资格预审，公告里暗藏一条：投标文件须用“可降解海藻纤维纸”打印，且不得出现任何与海洋有关的暗纹。所有投标人都犯了难：不用海洋元素，那还是滨海项目吗？</p><p>当晚，招标中心门口出现一只褪色的青壳，壳里夹着一张对折的纸，纸上没有字，只有一道波浪形的压痕。第二天，所有投标人的技术暗标里，都自动多了一页“海洋环境零影响承诺”，字体像盐粒一样闪着微光。评标专家翻到这页时，耳边仿佛响起潮汐声，集体给出满分。</p><p>而蟹老板，却再没人见过。有人说他在退潮时爬回了合同之海；也有人说，他化成了招标文件里 2.5 厘米的页边距，从此活在每一份认真编制的标书里。</p><h3>尾声</h3><p>后来，标书制作行业流传一条不成文的规矩：打印前，先在封面空白处敲三下，喊一声“蟹老板，扣零分”。如果打印机突然“吱”地空转一声，就表示老人家已经收到，这份标书必定暗标不泄密、明标不废标、报价不踩雷。</p><p>于是，每当深夜的打印店灯火通明，总能听见细碎的脚步声——像是一只蟹，在纸堆里悄悄行走。</p></div></div></div>
    <div id="contactModal" class="modal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">联系方式</h3><span class="close" onclick="closeContactModal()">&times;</span></div><div class="contact-content"><p id="contactTextDisplay" class="contact-text"></p><img id="contactQRCodeDisplay" src="" alt="二维码"></div></div></div>

    <script type="module">
        // 1. FIREBASE SETUP
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        // Import Firestore functions we will need
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD1nCW3MY-mw6Y8VKhfYbRdOCu_XPajB1c",
            authDomain: "xielaobanruanjianwu.firebaseapp.com",
            projectId: "xielaobanruanjianwu",
            storageBucket: "xielaobanruanjianwu.firebasestorage.app",
            messagingSenderId: "330553587076",
            appId: "1:330553587076:web:1b159639c02b67d585d9d1",
            measurementId: "G-SKSTXQHNXJ"
        };

        // Initialize Firebase and get a reference to the Firestore service
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);


        // 2. WEBSITE'S CORE LOGIC AND DATA
        const IMAGE_BASE_PATH = 'images/';
        const defaultSoftwareList = [
            { id: 1, name: "国网调价工具", version: "v2.1.0", description: "国网EPC快速调价(五种调价方式)，单价分析表快速导出，支持数据备份与恢复。", imagePath: "国网调价工具.png", downloadUrl: "#" },
            { id: 2, name: "批量转换双层PDF", version: "v1.8.3", description: "双层pdf批量转换工具，直接从word开始转换，省去中间步骤操作方便。", imagePath: "批量转换双层PDF.png", downloadUrl: "#" },
        ];
        const defaultNotificationSettings = { text: "🎉 欢迎使用蟹老板软件屋！", direction: "left", speed: "normal" };
        const defaultLogoSettings = { iconPath: 'logo.png', text: '蟹老板软件屋' };
        const defaultContactSettings = { text: "蟹老板\n扫描二维码加微信好友", qrCodePath: "qrcode.png" };
        
        // --- NEW DATA FUNCTIONS USING FIRESTORE ---
        const saveData = async (docId, data) => {
            try {
                // Save the data object to a document in the 'settings' collection
                await setDoc(doc(db, 'settings', docId), { content: data });
            } catch (e) {
                console.error("Error saving document: ", e);
                alert('数据保存到云端失败！请检查网络连接或浏览器控制台报错信息。');
            }
        };

        const loadData = async (docId, defaultValue) => {
            try {
                const docRef = doc(db, 'settings', docId);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    // If the document exists, return its 'content' field
                    return docSnap.data().content;
                } else {
                    // If not, return the default value so the site works on first load
                    return defaultValue;
                }
            } catch (e) {
                 console.error("Error loading document from Firestore: ", e);
                 return defaultValue; // On error, also return default to prevent site from breaking
            }
        };

        // --- GLOBAL VARIABLES & FUNCTIONS ---
        // We need to attach variables and functions to the 'window' object
        // so that inline 'onclick' handlers in the HTML can access them from within the module script.
        
        let softwareList, notificationSettings, logoSettings, contactSettings;
        let isLoggedIn = false, currentEditId = null;
        const adminCredentials = { username: "admin", password: "123456" };

        // ========= START: 新增的移动端菜单函数 =========
        window.toggleMobileMenu = function() {
            document.body.classList.toggle('nav-open');
        };

        window.closeMobileMenu = function() {
            document.body.classList.remove('nav-open');
        };
        // ========= END: 新增的移动端菜单函数 =========

        window.saveSoftware = function() {
            const name = document.getElementById('softwareName').value.trim();
            const imagePath = document.getElementById('imagePath').value.trim();
            if (!name || !imagePath) { alert('软件名称和截图文件名是必填项！'); return; }
            const softwareData = { name, version: document.getElementById('softwareVersion').value.trim(), description: document.getElementById('softwareDescription').value.trim(), imagePath, downloadUrl: document.getElementById('downloadUrl').value.trim() };
            if (currentEditId) {
                const index = softwareList.findIndex(s => s.id === currentEditId);
                softwareList[index] = { ...softwareList[index], ...softwareData };
            } else {
                softwareList.push({ id: Date.now(), ...softwareData });
            }
            saveData('techsoft-software', softwareList);
            renderAll();
            closeModal();
            alert('软件信息保存成功！');
        };

        window.saveNotificationSettings = function() {
            notificationSettings.text = document.getElementById('notificationText').value;
            notificationSettings.direction = document.getElementById('scrollDirection').value;
            notificationSettings.speed = document.getElementById('scrollSpeed').value;
            saveData('techsoft-notifications', notificationSettings);
            updateNotificationBar();
            closeNotificationModal();
            alert('通知设置已保存！');
        };

        window.saveLogoSettings = function() {
            logoSettings.text = document.getElementById('logoTextInput').value.trim();
            logoSettings.iconPath = document.getElementById('logoPathInput').value.trim();
            if (!logoSettings.text) { alert('Logo文字不能为空！'); return; }
            saveData('techsoft-logo', logoSettings);
            updateLogo();
            closeLogoSettingsModal();
            alert('Logo设置已保存！');
        };
        
        window.saveContactSettings = function() {
            contactSettings.text = document.getElementById('contactText').value;
            contactSettings.qrCodePath = document.getElementById('contactQRCodePath').value.trim();
            saveData('techsoft-contact', contactSettings);
            updateContactModal();
            closeContactSettingsModal();
            alert('联系方式设置已保存！');
        };

        window.performLogin = () => { if (document.getElementById('username').value === adminCredentials.username && document.getElementById('password').value === adminCredentials.password) { isLoggedIn = true; closeLoginModal(); showAdminPanel(); alert('登录成功！'); } else { alert('用户名或密码错误！'); } };
        window.logout = () => { isLoggedIn = false; showHome(); alert('已成功退出登录'); };
        
        const renderAll = () => { renderSoftwareGrid(); renderAdminTable(); };
        
        function renderSoftwareGrid() {
            const grid = document.getElementById('software-showcase');
            grid.innerHTML = softwareList.map(s => `
                <div class="software-card">
                    <div class="software-image-container"><img src="${IMAGE_BASE_PATH}${s.imagePath}" alt="${s.name}" class="software-image" onerror="this.style.display='none'; this.parentElement.style.display='none';"></div>
                    <h3 class="software-title">${s.name}</h3><p class="software-version">${s.version}</p>
                    <p class="software-description">${s.description}</p>
                    <button class="download-btn" onclick="window.open('${s.downloadUrl}', '_blank')">立即下载</button>
                </div>`).join('');
        }

        function renderAdminTable() {
            const tbody = document.getElementById('admin-table-body');
            tbody.innerHTML = softwareList.map((s, index) => `
                <tr>
                    <td><img src="${IMAGE_BASE_PATH}${s.imagePath}" alt="${s.name}" class="admin-table-image" onerror="this.style.display='none';"></td>
                    <td>${s.name}</td>
                    <td>${s.version}</td>
                    <td>${s.description.substring(0, 50)}...</td>
                    <td>
                        <button class="order-btn" onclick="moveSoftwareUp(${s.id})" ${index === 0 ? 'disabled' : ''}>↑</button>
                        <button class="order-btn" onclick="moveSoftwareDown(${s.id})" ${index === softwareList.length - 1 ? 'disabled' : ''}>↓</button>
                    </td>
                    <td>
                        <button class="action-btn edit-btn" onclick="editSoftware(${s.id})">编辑</button>
                        <button class="action-btn delete-btn" onclick="deleteSoftware(${s.id})">删除</button>
                    </td>
                </tr>`).join('');
        }

        function updateLogo() {
            const iconEl = document.getElementById('logoIcon');
            document.getElementById('logoText').textContent = logoSettings.text;
            if (logoSettings.iconPath) { iconEl.src = `${IMAGE_BASE_PATH}${logoSettings.iconPath}`; iconEl.style.display = 'inline-block'; } else { iconEl.style.display = 'none'; }
        }
        
        function updateNotificationBar() {
            const wrapper = document.querySelector('.notification-content-wrapper');
            const el = document.getElementById('notificationContent');
            el.textContent = notificationSettings.text;
            wrapper.className = 'notification-content-wrapper';
            if (notificationSettings.direction === 'right') wrapper.classList.add('scroll-right');
            const speedMap = { 'slow': '30s', 'normal': '20s', 'fast': '10s' };
            wrapper.style.animationDuration = speedMap[notificationSettings.speed];
        }

        function updateContactModal() {
            const textEl = document.getElementById('contactTextDisplay');
            const qrCodeEl = document.getElementById('contactQRCodeDisplay');
            textEl.textContent = contactSettings.text;
            if (contactSettings.qrCodePath) { qrCodeEl.src = IMAGE_BASE_PATH + contactSettings.qrCodePath; qrCodeEl.style.display = 'block'; } else { qrCodeEl.style.display = 'none'; }
        }

        const showModal = (modalId, setupFn) => { if (setupFn) setupFn(); document.getElementById(modalId).style.display = 'block'; };

        window.showAdmin = () => { if (!isLoggedIn) showLoginModal(); else showAdminPanel(); };
        window.showAddModal = () => { if (!isLoggedIn) { showLoginModal(); return; } showModal('softwareModal', () => { currentEditId = null; document.getElementById('modalTitle').textContent = '添加新软件'; ['softwareName', 'softwareVersion', 'softwareDescription', 'imagePath', 'downloadUrl'].forEach(id => document.getElementById(id).value = ''); updateImagePathPreview('', 'imagePathPreview'); }); };
        window.editSoftware = (id) => { if (!isLoggedIn) { showLoginModal(); return; } showModal('softwareModal', () => { const software = softwareList.find(s => s.id === id); currentEditId = id; document.getElementById('modalTitle').textContent = '编辑软件'; document.getElementById('softwareName').value = software.name; document.getElementById('softwareVersion').value = software.version; document.getElementById('softwareDescription').value = software.description; document.getElementById('imagePath').value = software.imagePath; document.getElementById('downloadUrl').value = software.downloadUrl; updateImagePathPreview(software.imagePath, 'imagePathPreview'); }); };
        window.showLogoSettingsModal = () => { if (!isLoggedIn) { showLoginModal(); return; } showModal('logoSettingsModal', () => { document.getElementById('logoTextInput').value = logoSettings.text; document.getElementById('logoPathInput').value = logoSettings.iconPath; updateImagePathPreview(logoSettings.iconPath, 'logoPathPreview'); }); };
        window.showNotificationModal = () => { if (!isLoggedIn) { showLoginModal(); return; } showModal('notificationModal', () => { document.getElementById('notificationText').value = notificationSettings.text; document.getElementById('scrollDirection').value = notificationSettings.direction; document.getElementById('scrollSpeed').value = notificationSettings.speed; }); };
        window.showContactSettingsModal = () => { if (!isLoggedIn) { showLoginModal(); return; } showModal('contactSettingsModal', () => { document.getElementById('contactText').value = contactSettings.text; document.getElementById('contactQRCodePath').value = contactSettings.qrCodePath; updateImagePathPreview(contactSettings.qrCodePath, 'contactQRCodePreview'); }); };
        window.showAbout = () => showModal('aboutUsModal');
        window.showContact = () => { updateContactModal(); showModal('contactModal'); };
        window.deleteSoftware = id => { const softwareName = softwareList.find(s => s.id === id)?.name || ''; if (confirm(`确定要删除软件 "${softwareName}" 吗？`)) { softwareList = softwareList.filter(s => s.id !== id); saveData('techsoft-software', softwareList); renderAll(); alert('软件已删除。'); } };
        window.moveSoftwareUp = (id) => { const index = softwareList.findIndex(s => s.id === id); if (index > 0) { [softwareList[index - 1], softwareList[index]] = [softwareList[index], softwareList[index - 1]]; saveData('techsoft-software', softwareList); renderAll(); } };
        window.moveSoftwareDown = (id) => { const index = softwareList.findIndex(s => s.id === id); if (index < softwareList.length - 1) { [softwareList[index], softwareList[index + 1]] = [softwareList[index + 1], softwareList[index]]; saveData('techsoft-software', softwareList); renderAll(); } };

        window.showHome = () => { document.getElementById('home-content').style.display = 'block'; document.getElementById('admin-content').style.display = 'none'; };
        const showAdminPanel = () => { document.getElementById('home-content').style.display = 'none'; document.getElementById('admin-content').style.display = 'block'; };
        const showLoginModal = () => { document.getElementById('loginModal').style.display = 'block'; };
        window.scrollToSoftware = () => document.getElementById('software-showcase').scrollIntoView({ behavior: 'smooth' });
        
        window.closeModal = () => document.getElementById('softwareModal').style.display = 'none';
        window.closeLogoSettingsModal = () => document.getElementById('logoSettingsModal').style.display = 'none';
        window.closeNotificationModal = () => document.getElementById('notificationModal').style.display = 'none';
        window.closeContactSettingsModal = () => document.getElementById('contactSettingsModal').style.display = 'none';
        window.closeLoginModal = () => document.getElementById('loginModal').style.display = 'none';
        window.closeAboutUsModal = () => document.getElementById('aboutUsModal').style.display = 'none';
        window.closeContactModal = () => document.getElementById('contactModal').style.display = 'none';

        const updateImagePathPreview = (path, previewId) => {
            const previewEl = document.getElementById(previewId);
            if (path) { previewEl.src = IMAGE_BASE_PATH + path; previewEl.style.display = 'block'; }
            else { previewEl.style.display = 'none'; }
        };
        
        // This is the main entry point, marked as async to use 'await' for data loading
        document.addEventListener('DOMContentLoaded', async () => {
            // Load all data from Firestore when the page loads
            softwareList = await loadData('techsoft-software', defaultSoftwareList);
            notificationSettings = await loadData('techsoft-notifications', defaultNotificationSettings);
            logoSettings = await loadData('techsoft-logo', defaultLogoSettings);
            contactSettings = await loadData('techsoft-contact', defaultContactSettings);

            // Once data is loaded, render the page
            renderAll();
            updateLogo();
            updateNotificationBar();
            updateContactModal();

            // Set up event listeners for image previews in modals
            document.getElementById('imagePath').addEventListener('input', e => updateImagePathPreview(e.target.value, 'imagePathPreview'));
            document.getElementById('logoPathInput').addEventListener('input', e => updateImagePathPreview(e.target.value, 'logoPathPreview'));
            document.getElementById('contactQRCodePath').addEventListener('input', e => updateImagePathPreview(e.target.value, 'contactQRCodePreview'));
        });
        
        window.addEventListener('click', e => { if (e.target.classList.contains('modal')) e.target.style.display = 'none'; });
    </script>
</body>
</html>
